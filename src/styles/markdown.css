/* 引入 Tailwind 工具类模块（必须添加，否则 @layer utilities 无效） */
@tailwind utilities;

/* 定义自定义工具类 */
@layer utilities {
  .btn-regular-dark {
    @apply bg-[var(--btn-regular-bg)] 
           text-[var(--btn-regular-text)] 
           hover:bg-[var(--btn-regular-bg-hover)] 
           active:bg-[var(--btn-regular-bg-active)] 
           transition-colors 
           duration-200;
  }

  /* 修复 hover 压扁问题的徽章基础类 */
  .badge-starlight {
    @apply inline-flex items-center gap-1.5 px-3 py-1 rounded-md font-medium text-white
           shadow-sm transition-all duration-200 hover:scale-105 hover:shadow-md;
    transform-origin: center center; /* 核心：缩放从中心开始，避免文字偏移/压扁 */
    line-height: 1; /* 固定行高，防止缩放时文字挤压 */
  }

  /* 新增：仿 Starlight 徽章核心样式（完全匹配官网效果） */
  /* 基础徽章类 - 控制布局、圆角、动效、文字样式 */
  .badge-starlight {
    @apply inline-flex items-center gap-1.5 px-3 py-1 rounded-md font-medium text-white
           shadow-sm transition-all duration-200 hover:scale-105 hover:shadow-md;
  }
  /* Astro 蓝紫渐变（Starlight 官网同款） */
  .badge-starlight-astro {
    @apply badge-starlight bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-700 dark:to-purple-700;
  }
  /* 纯紫渐变（贡献者徽章样式） */
  .badge-starlight-purple {
    @apply badge-starlight bg-gradient-to-r from-purple-700 to-purple-900 dark:from-purple-800 dark:to-purple-950;
  }
  /* 绿渐变（成功状态） */
  .badge-starlight-green {
    @apply badge-starlight bg-gradient-to-r from-emerald-600 to-green-600 dark:from-emerald-700 dark:to-green-700;
  }
  /* 橙渐变（警告状态） */
  .badge-starlight-orange {
    @apply badge-starlight bg-gradient-to-r from-orange-500 to-amber-600 dark:from-orange-600 dark:to-amber-700;
  }
  /* 图标对齐类 - 保证徽章内图标和文字垂直居中 */
  .badge-starlight-icon {
    @apply w-4 h-4 inline-block align-middle;
  }
  /* 修复后的小号徽章（调整内边距/行高） */
  .badge-starlight-sm {
    @apply px-2 py-0.5 text-xs tracking-wider uppercase;
    line-height: 1.1; /* 适配小号文字行高，避免压扁 */
    gap: 1; /* 缩小图标和文字间距，适配小号尺寸 */
  }
}

.custom-md {
    h1 {
        @apply text-3xl;
    }

    h1, h2, h3, h4, h5, h6 {
        .anchor {
            @apply transition -m-0.5 ml-[0.2ch] p-0.5 select-none opacity-0 no-underline !important;

            .anchor-icon {
                @apply mx-[0.45ch] !important;
            }
        }

        &:hover {
            .anchor {
                @apply opacity-100 !important;
            }
        }
    }

    a:not(.no-styling) {
        @apply relative bg-none transition rounded-md p-1 -m-1 font-medium text-[var(--primary)]
        before:ease-out before:transition active:bg-none hover:before:bg-[var(--btn-plain-bg-hover)] active:before:bg-[var(--btn-plain-bg-active)] z-0
        before:absolute before:rounded-[inherit] before:inset-0 before:scale-[0.85] hover:before:scale-100 before:-z-10
        underline decoration-[var(--link-underline)] decoration-1 decoration-dashed underline-offset-4;
        box-decoration-break: clone;
        -webkit-box-decoration-break: clone;
        
        word-break: break-all;
        word-wrap: break-word;
        overflow-wrap: break-word;
    
        &:hover, &:active {
            @apply decoration-transparent;
            background: var(--btn-plain-bg-hover);
            border-bottom: 1px dashed var(--link-hover);
            text-decoration: none;
        }
    }

    code {
        @apply bg-[var(--inline-code-bg)] text-[var(--inline-code-color)] px-1 py-0.5 rounded-md overflow-hidden;

        font-family: 'JetBrains Mono Variable', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace;
        &:before {
            content:none;
        }
        &:after {
            content:none;
        }

        counter-reset: line;
        span.line {
            &:before {
                @apply text-white/25 mr-4 w-4 inline-block;
                content: counter(line);
                counter-increment: line;
                direction: rtl;
            }
            &:last-child:empty, &:last-child:has(> span:empty:only-child) {
                display: none;
            }
        }
    }

    .copy-btn {
        all: initial;
        @apply btn-regular-dark opacity-0 shadow-lg shadow-black/50 absolute active:scale-90 h-8 w-8 top-3 right-3 text-sm rounded-lg transition-all ease-in-out z-20 cursor-pointer;
    }
    .frame:hover .copy-btn {
        opacity: 1;
    }

    .copy-btn-icon {
        @apply absolute top-1/2 left-1/2 transition -translate-x-1/2 -translate-y-1/2 w-4 h-4 fill-white pointer-events-none;
    }
    .copy-btn .copy-icon {
        @apply opacity-100 fill-white dark:fill-white/75;
    }
    .copy-btn.success .copy-icon {
        @apply opacity-0 fill-[var(--deep-text)]
    }
    .copy-btn .success-icon {
        @apply opacity-0 fill-white;
    }
    .copy-btn.success .success-icon {
        @apply opacity-100
    }

    .expressive-code {
        @apply my-4;
        ::selection {
            @apply bg-[var(--codeblock-selection)];
        }
    }

    ul, ol {
        li::marker {
            @apply text-[var(--primary)];
        }
    }

    blockquote {
        @apply not-italic border-transparent relative;
        font-weight: inherit;

        &:before {
            @apply content-[''] absolute -left-1 block transition bg-[var(--btn-regular-bg)] h-full w-1 rounded-full;
        }

        /* Remove the double quotes from default styles */
        p:before, p:after {
            @apply content-none;
        }

    }

    /* 新增：Markdown 纯文本高光（==文字==）样式（适配 Fuwari 主题） */
    mark {
        @apply bg-[#fce7f3] text-[#be185d] px-[0.25rem] py-[0.1rem] rounded-md font-medium;
    }

    /* 深色模式下的高光样式 */
    .dark & mark {
        @apply bg-[#4a1d3a] text-[#fecdd3];
    }
}